name: SkyVPNX Login Test

on:
  workflow_dispatch:   # 手动触发

jobs:
  login:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: pip install cloudscraper

      - name: Run login script
        env:
          EMAIL: ${{ secrets.SKYVPN_EMAIL }}
          PASSWORD: ${{ secrets.SKYVPN_PASSWORD }}
        run: |
          python3 - <<'EOF'
          import cloudscraper, os
          scraper = cloudscraper.create_scraper()
          login_url = "https://skyvpnx.com/login"
          payload = {
              "email": os.environ["EMAIL"],
              "password": os.environ["PASSWORD"]
          }
          resp = scraper.post(login_url, data=payload)
          if resp.status_code == 200 and "用户中心" in resp.text:
              print("ok")
          else:
              print("登录失败:", resp.status_code)
          EOF